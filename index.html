<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>وکال‌اپ - پلتفرم مشاوره حقوقی</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #007AFF;
            --secondary-color: #5856D6;
            --success-color: #34C759;
            --warning-color: #FF9500;
            --danger-color: #FF3B30;
            --background-color: #F2F2F7;
            --card-background: #FFFFFF;
            --text-primary: #1C1C1E;
            --text-secondary: #8E8E93;
            --border-color: #E5E5EA;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --border-radius: 12px;
        }

        body {
            background: var(--background-color);
            color: var(--text-primary);
            direction: rtl;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--card-background);
            padding: 20px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .nav-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
        }

        /* Main Content */
        .main-content {
            margin-top: 30px;
        }

        .panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: var(--card-background);
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #0056CC;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        /* Lawyer Cards */
        .lawyer-card {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .lawyer-card:hover {
            transform: translateY(-5px);
        }

        .lawyer-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .lawyer-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .lawyer-specialty {
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .lawyer-rating {
            color: var(--warning-color);
            margin-bottom: 10px;
        }

        /* Chat Interface */
        .chat-container {
            height: 400px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--background-color);
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
        }

        .message.received .message-content {
            background: var(--card-background);
            color: var(--text-primary);
        }

        .message.sent .message-content {
            background: var(--primary-color);
            color: white;
        }

        .chat-input {
            display: flex;
            padding: 15px;
            background: var(--card-background);
            border-top: 1px solid var(--border-color);
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            margin-left: 10px;
        }

        /* Calendar */
        .calendar {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .calendar-day:hover {
            background: var(--background-color);
        }

        .calendar-day.selected {
            background: var(--primary-color);
            color: white;
        }

        .calendar-day.available {
            background: var(--success-color);
            color: white;
        }

        /* Time Slots */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .time-slot {
            padding: 10px;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-slot:hover {
            border-color: var(--primary-color);
        }

        .time-slot.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Status Badges */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background: var(--success-color);
            color: white;
        }

        .badge-warning {
            background: var(--warning-color);
            color: white;
        }

        .badge-danger {
            background: var(--danger-color);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.error {
            background: var(--danger-color);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">وکال‌اپ</div>
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showPanel('client')">پنل موکل</button>
                <button class="nav-tab" onclick="showPanel('lawyer')">پنل وکیل</button>
                <button class="nav-tab" onclick="showPanel('admin')">پنل مدیر</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="main-content">
            <!-- Client Panel -->
            <div id="client-panel" class="panel active">
                <div class="card">
                    <h2 class="card-title">مشکل حقوقی خود را شرح دهید</h2>
                    <form id="legal-issue-form">
                        <div class="form-group">
                            <label class="form-label">نوع مشکل حقوقی</label>
                            <select class="form-select" id="issue-type" required>
                                <option value="">انتخاب کنید</option>
                                <option value="family">خانواده و طلاق</option>
                                <option value="civil">حقوق مدنی</option>
                                <option value="criminal">کیفری</option>
                                <option value="commercial">تجاری</option>
                                <option value="labor">کار و تامین اجتماعی</option>
                                <option value="property">املاک و مستغلات</option>
                                <option value="tax">مالیاتی</option>
                                <option value="other">سایر</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">شرح کامل مشکل</label>
                            <textarea class="form-textarea" id="issue-description" placeholder="مشکل حقوقی خود را به طور کامل شرح دهید..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">شماره تماس</label>
                            <input type="tel" class="form-input" id="client-phone" placeholder="09123456789" required>
                        </div>
                        <button type="submit" class="btn btn-primary">ارسال و یافتن وکیل مناسب</button>
                    </form>
                </div>

                <div id="lawyers-list" class="grid grid-3" style="display: none;">
                    <h3 style="grid-column: 1 / -1; margin-bottom: 20px;">وکلا پیشنهادی برای مشکل شما:</h3>
                </div>

                <div id="appointment-section" style="display: none;">
                    <div class="card">
                        <h3 class="card-title">رزرو نوبت</h3>
                        <div id="selected-lawyer-info"></div>
                        <div class="calendar">
                            <div class="calendar-header">
                                <button class="btn btn-secondary" onclick="previousMonth()">ماه قبل</button>
                                <h4 id="current-month">تیر ۱۴۰۲</h4>
                                <button class="btn btn-secondary" onclick="nextMonth()">ماه بعد</button>
                            </div>
                            <div class="calendar-grid" id="calendar-grid"></div>
                        </div>
                        <div class="time-slots" id="time-slots"></div>
                        <button class="btn btn-success" onclick="bookAppointment()" style="margin-top: 20px;">رزرو نوبت</button>
                    </div>
                </div>

                <div id="chat-section" style="display: none;">
                    <div class="card">
                        <h3 class="card-title">گفتگو با وکیل</h3>
                        <div class="chat-container">
                            <div class="chat-messages" id="chat-messages"></div>
                            <div class="chat-input">
                                <input type="text" id="chat-input" placeholder="پیام خود را بنویسید...">
                                <button class="btn btn-primary" onclick="sendMessage()">ارسال</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lawyer Panel -->
            <div id="lawyer-panel" class="panel">
                <div class="card">
                    <h2 class="card-title">مدیریت زمان‌های خالی</h2>
                    <form id="availability-form">
                        <div class="form-group">
                            <label class="form-label">تاریخ (شمسی)</label>
                            <input type="text" class="form-input" id="persian-date" placeholder="۱۴۰۲/۰۴/۱۵" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ساعت شروع</label>
                            <input type="time" class="form-input" id="start-time" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ساعت پایان</label>
                            <input type="time" class="form-input" id="end-time" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">نوع مشاوره</label>
                            <select class="form-select" id="consultation-type">
                                <option value="chat">چت</option>
                                <option value="call">تماس تلفنی</option>
                                <option value="meeting">حضوری</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">افزودن زمان خالی</button>
                    </form>
                </div>

                <div class="card">
                    <h3 class="card-title">نوبت‌های رزرو شده</h3>
                    <div id="lawyer-appointments"></div>
                </div>

                <div class="card">
                    <h3 class="card-title">گفتگو با موکلین</h3>
                    <div id="lawyer-chats"></div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="admin-panel" class="panel">
                <div class="grid grid-2">
                    <div class="card">
                        <h3 class="card-title">آمار کلی</h3>
                        <div id="admin-stats">
                            <p>تعداد کل موکلین: <span id="total-clients">0</span></p>
                            <p>تعداد کل وکلا: <span id="total-lawyers">0</span></p>
                            <p>نوبت‌های امروز: <span id="today-appointments">0</span></p>
                            <p>مشاوره‌های انجام شده: <span id="completed-consultations">0</span></p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title">وکلا</h3>
                        <div id="admin-lawyers"></div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">درخواست‌های جدید</h3>
                    <div id="admin-requests"></div>
                </div>

                <div class="card">
                    <h3 class="card-title">گزارش‌ها</h3>
                    <div id="admin-reports"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="appointment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>تایید نوبت</h3>
                <button class="modal-close" onclick="closeModal('appointment-modal')">&times;</button>
            </div>
            <div id="appointment-details"></div>
            <button class="btn btn-success" onclick="confirmAppointment()">تایید نوبت</button>
        </div>
    </div>

    <script>
        // Global Variables
        let currentPanel = 'client';
        let selectedLawyer = null;
        let selectedDate = null;
        let selectedTime = null;
        let currentMonth = 4; // تیر
        let currentYear = 1402;

        // Sample Data
        const lawyers = [
            {
                id: 1,
                name: "دکتر احمد محمدی",
                specialty: "خانواده و طلاق",
                rating: 4.8,
                experience: "۱۵ سال",
                avatar: "AM"
            },
            {
                id: 2,
                name: "دکتر فاطمه کریمی",
                specialty: "حقوق مدنی",
                rating: 4.9,
                experience: "۱۲ سال",
                avatar: "FK"
            },
            {
                id: 3,
                name: "دکتر علی رضایی",
                specialty: "کیفری",
                rating: 4.7,
                experience: "۱۸ سال",
                avatar: "AR"
            },
            {
                id: 4,
                name: "دکتر مریم احمدی",
                specialty: "تجاری",
                rating: 4.6,
                experience: "۱۰ سال",
                avatar: "MA"
            }
        ];

        const clients = [];
        const appointments = [];
        const chats = [];

        // Panel Navigation
        function showPanel(panelName) {
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(panelName + '-panel').classList.add('active');
            event.target.classList.add('active');
            currentPanel = panelName;
            
            if (panelName === 'admin') {
                updateAdminPanel();
            }
        }

        // Client Panel Functions
        document.getElementById('legal-issue-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const issueType = document.getElementById('issue-type').value;
            const description = document.getElementById('issue-description').value;
            const phone = document.getElementById('client-phone').value;

            // AI-powered lawyer matching
            const matchedLawyers = matchLawyers(issueType, description);
            displayLawyers(matchedLawyers);
            
            showNotification('درخواست شما با موفقیت ثبت شد و وکلا مناسب پیدا شدند', 'success');
        });

        function matchLawyers(issueType, description) {
            // Simple AI matching based on specialty and keywords
            const keywords = description.toLowerCase();
            let matchedLawyers = lawyers.filter(lawyer => {
                if (issueType === lawyer.specialty.toLowerCase()) return true;
                
                const specialtyKeywords = {
                    'family': ['خانواده', 'طلاق', 'مهریه', 'نفقه'],
                    'civil': ['مدنی', 'قرارداد', 'مالکیت'],
                    'criminal': ['کیفری', 'جرم', 'مجازات'],
                    'commercial': ['تجاری', 'شرکت', 'بازرگانی'],
                    'labor': ['کار', 'تامین اجتماعی', 'کارگری'],
                    'property': ['املاک', 'مستغلات', 'ملک'],
                    'tax': ['مالیاتی', 'مالیات', 'دارایی']
                };

                const relevantKeywords = specialtyKeywords[issueType] || [];
                return relevantKeywords.some(keyword => keywords.includes(keyword));
            });

            return matchedLawyers.length > 0 ? matchedLawyers : lawyers.slice(0, 2);
        }

        function displayLawyers(lawyersList) {
            const container = document.getElementById('lawyers-list');
            container.innerHTML = '<h3 style="grid-column: 1 / -1; margin-bottom: 20px;">وکلا پیشنهادی برای مشکل شما:</h3>';
            
            lawyersList.forEach(lawyer => {
                const lawyerCard = document.createElement('div');
                lawyerCard.className = 'lawyer-card';
                lawyerCard.onclick = () => selectLawyer(lawyer);
                
                lawyerCard.innerHTML = `
                    <div class="lawyer-avatar">${lawyer.avatar}</div>
                    <div class="lawyer-name">${lawyer.name}</div>
                    <div class="lawyer-specialty">${lawyer.specialty}</div>
                    <div class="lawyer-rating">⭐ ${lawyer.rating} (${lawyer.experience} تجربه)</div>
                    <button class="btn btn-primary" style="margin-top: 10px;">انتخاب وکیل</button>
                `;
                
                container.appendChild(lawyerCard);
            });
            
            container.style.display = 'grid';
        }

        function selectLawyer(lawyer) {
            selectedLawyer = lawyer;
            document.getElementById('selected-lawyer-info').innerHTML = `
                <div style="background: var(--background-color); padding: 15px; border-radius: var(--border-radius); margin-bottom: 20px;">
                    <h4>وکیل انتخاب شده: ${lawyer.name}</h4>
                    <p>تخصص: ${lawyer.specialty}</p>
                    <p>امتیاز: ⭐ ${lawyer.rating}</p>
                </div>
            `;
            document.getElementById('appointment-section').style.display = 'block';
            generateCalendar();
        }

        // Calendar Functions
        function generateCalendar() {
            const persianMonths = ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور', 'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'];
            document.getElementById('current-month').textContent = `${persianMonths[currentMonth - 1]} ${currentYear}`;
            
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            
            // Add day headers
            const days = ['ش', 'ی', 'د', 'س', 'چ', 'پ', 'ج'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day';
                dayHeader.style.fontWeight = 'bold';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Add calendar days
            const daysInMonth = 31; // Simplified
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = i;
                dayElement.onclick = () => selectDate(i);
                
                // Mark some days as available
                if (i % 3 === 0) {
                    dayElement.classList.add('available');
                }
                
                grid.appendChild(dayElement);
            }
        }

        function selectDate(day) {
            document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedDate = `${currentYear}/${currentMonth.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}`;
            generateTimeSlots();
        }

        function generateTimeSlots() {
            const container = document.getElementById('time-slots');
            container.innerHTML = '';
            
            const times = ['09:00', '10:00', '11:00', '14:00', '15:00', '16:00', '17:00'];
            times.forEach(time => {
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                slot.textContent = time;
                slot.onclick = () => selectTime(time);
                container.appendChild(slot);
            });
        }

        function selectTime(time) {
            document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedTime = time;
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
            }
            generateCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            }
            generateCalendar();
        }

        function bookAppointment() {
            if (!selectedLawyer || !selectedDate || !selectedTime) {
                showNotification('لطفاً وکیل، تاریخ و زمان را انتخاب کنید', 'error');
                return;
            }
            
            const modal = document.getElementById('appointment-modal');
            const details = document.getElementById('appointment-details');
            
            details.innerHTML = `
                <p><strong>وکیل:</strong> ${selectedLawyer.name}</p>
                <p><strong>تاریخ:</strong> ${selectedDate}</p>
                <p><strong>ساعت:</strong> ${selectedTime}</p>
                <p><strong>نوع مشاوره:</strong> حضوری</p>
            `;
            
            modal.classList.add('active');
        }

        function confirmAppointment() {
            const appointment = {
                id: Date.now(),
                lawyer: selectedLawyer,
                client: {
                    name: 'موکل',
                    phone: document.getElementById('client-phone').value
                },
                date: selectedDate,
                time: selectedTime,
                type: 'meeting',
                status: 'confirmed'
            };
            
            appointments.push(appointment);
            closeModal('appointment-modal');
            showNotification('نوبت شما با موفقیت رزرو شد', 'success');
            
            // Show chat section
            document.getElementById('chat-section').style.display = 'block';
            initializeChat();
        }

        // Lawyer Panel Functions
        document.getElementById('availability-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('persian-date').value;
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            const type = document.getElementById('consultation-type').value;
            
            // Add availability
            const availability = {
                id: Date.now(),
                date: date,
                startTime: startTime,
                endTime: endTime,
                type: type,
                lawyer: { name: 'وکیل' }
            };
            
            showNotification('زمان خالی با موفقیت اضافه شد', 'success');
            this.reset();
            updateLawyerAppointments();
        });

        function updateLawyerAppointments() {
            const container = document.getElementById('lawyer-appointments');
            const lawyerAppointments = appointments.filter(apt => apt.lawyer.id === 1); // Assuming current lawyer
            
            if (lawyerAppointments.length === 0) {
                container.innerHTML = '<p>هیچ نوبتی رزرو نشده است</p>';
                return;
            }
            
            container.innerHTML = lawyerAppointments.map(apt => `
                <div style="background: var(--background-color); padding: 15px; border-radius: var(--border-radius); margin-bottom: 10px;">
                    <p><strong>موکل:</strong> ${apt.client.name}</p>
                    <p><strong>تاریخ:</strong> ${apt.date}</p>
                    <p><strong>ساعت:</strong> ${apt.time}</p>
                    <p><strong>وضعیت:</strong> <span class="badge badge-success">تایید شده</span></p>
                </div>
            `).join('');
        }

        // Chat Functions
        function initializeChat() {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = `
                <div class="message received">
                    <div class="message-content">
                        سلام، من وکیل شما هستم. چطور می‌تونم کمکتون کنم؟
                    </div>
                </div>
            `;
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messagesContainer = document.getElementById('chat-messages');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message sent';
            userMessage.innerHTML = `<div class="message-content">${message}</div>`;
            messagesContainer.appendChild(userMessage);
            
            // Add lawyer response (simulated)
            setTimeout(() => {
                const lawyerMessage = document.createElement('div');
                lawyerMessage.className = 'message received';
                lawyerMessage.innerHTML = `<div class="message-content">متوجه شدم. بذارید بررسی کنم و راهنمایی‌تون کنم.</div>`;
                messagesContainer.appendChild(lawyerMessage);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 1000);
            
            input.value = '';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Admin Panel Functions
        function updateAdminPanel() {
            document.getElementById('total-clients').textContent = clients.length + 5;
            document.getElementById('total-lawyers').textContent = lawyers.length;
            document.getElementById('today-appointments').textContent = appointments.length;
            document.getElementById('completed-consultations').textContent = Math.floor(Math.random() * 50) + 20;
            
            // Display lawyers
            const lawyersContainer = document.getElementById('admin-lawyers');
            lawyersContainer.innerHTML = lawyers.map(lawyer => `
                <div style="background: var(--background-color); padding: 15px; border-radius: var(--border-radius); margin-bottom: 10px;">
                    <p><strong>${lawyer.name}</strong></p>
                    <p>تخصص: ${lawyer.specialty}</p>
                    <p>امتیاز: ⭐ ${lawyer.rating}</p>
                    <button class="btn btn-warning" style="margin-top: 5px;">ویرایش</button>
                </div>
            `).join('');
            
            // Display requests
            const requestsContainer = document.getElementById('admin-requests');
            requestsContainer.innerHTML = `
                <div style="background: var(--background-color); padding: 15px; border-radius: var(--border-radius); margin-bottom: 10px;">
                    <p><strong>درخواست جدید مشاوره</strong></p>
                    <p>نوع: خانواده و طلاق</p>
                    <p>وضعیت: <span class="badge badge-warning">در انتظار</span></p>
                    <button class="btn btn-success" style="margin-top: 5px;">تایید</button>
                </div>
            `;
            
            // Display reports
            const reportsContainer = document.getElementById('admin-reports');
            reportsContainer.innerHTML = `
                <div style="background: var(--background-color); padding: 15px; border-radius: var(--border-radius); margin-bottom: 10px;">
                    <p><strong>گزارش ماهانه</strong></p>
                    <p>تعداد مشاوره‌ها: ۱۵۰</p>
                    <p>درآمد کل: ۲۵,۰۰۰,۰۰۰ تومان</p>
                    <p>رضایت مشتریان: ۹۲٪</p>
                </div>
            `;
        }

        // Utility Functions
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Event Listeners
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateLawyerAppointments();
            updateAdminPanel();
        });
    </script>
</body>
</html>
